---
- name: "Unzip win32yank utility"
  become: true
  unarchive:
    src: https://github.com/equalsraf/win32yank/releases/download/v0.0.4/win32yank-x64.zip
    dest: /usr/local/bin/
    remote_src: true
    mode: 0755
  when: ansible_os_family == "Debian"

- name: "Clone neovim stable branch"
  become_user: "{{ username }}"
  git:
    repo: "https://github.com/neovim/neovim"
    dest: "{{ homedir }}/projects/neovim"
    version: stable
    force: true
    depth: 1
  register: update_neovim

- name: "Install neovim"
  become: true
  shell: "make CMAKE_BUILD_TYPE=RelWithDebInfo && make install"
  args:
    chdir: "{{ homedir }}/projects/neovim"
  when: update_neovim.changed
  retries: 3

- name: "Copy nvim conf"
  copy:
    src: "{{ role_path }}/files/nvim/"
    dest: "{{ homedir }}/.config/nvim/"
    mode: 0644
    owner: "{{ username }}"

- import_tasks: plugins.yml
